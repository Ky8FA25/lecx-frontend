@if (loading()) {
  <div class="d-flex align-items-center justify-content-center" style="height: 100vh;">
    <div class="spinner-border" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
  </div>
} @else if (questions() && questions().length > 0) {
  <div class="container">
    <div class="test-container">
      <!-- Left-side question navigation with timer -->
      <div class="question-nav">
        <div class="timer mb-4">
          <strong>Time left:</strong> {{ formatTime(timeLeft()) }}
        </div>

        <div class="progress mb-4">
          <div 
            class="progress-bar" 
            role="progressbar" 
            [style.width.%]="getProgress()" 
            [attr.aria-valuenow]="getProgress()" 
            aria-valuemin="0" 
            aria-valuemax="100">
            {{ getProgress() | number:'1.0-0' }}%
          </div>
        </div>

        <!-- Question navigation buttons -->
        <div class="question-nav-buttons">
          @for (question of questions(); track question.questionId; let i = $index) {
            <button 
              type="button" 
              class="btn"
              [class.btn-primary]="currentQuestionIndex() === i"
              [class.btn-success]="currentQuestionIndex() !== i && isQuestionAnswered(question.questionId)"
              [class.btn-secondary]="currentQuestionIndex() !== i && !isQuestionAnswered(question.questionId)"
              [class.active]="currentQuestionIndex() === i"
              (click)="showQuestion(i)"
              [title]="isQuestionAnswered(question.questionId) ? 'Answered' : 'Not answered'">
              {{ i + 1 }}
            </button>
          }
        </div>

        <button 
          type="button" 
          (click)="openConfirmModal()" 
          class="btn btn-danger w-100 mt-3"
          [disabled]="submitting()">
          @if (submitting()) {
            <span class="spinner-border spinner-border-sm me-2" role="status"></span>
          }
          Submit
        </button>
      </div>

      <!-- Right-side question and answers section -->
      <div class="question-content">
        @if (currentQuestion()) {
          @let question = currentQuestion()!;
          @let questionNumber = currentQuestionIndex() + 1;
          
          <div class="question-box">
            <h5><strong>Question {{ questionNumber }}:</strong> {{ question.questionContent }}</h5>
            
            @if (question.imagePath) {
              <div class="mt-3">
                <img [src]="question.imagePath" alt="Question Image" class="img-fluid img-thumbnail" style="max-width: 500px; max-height: 500px;" />
              </div>
            }
          
            <div class="answer-options">
              <div class="form-check">
                <input 
                  class="form-check-input" 
                  type="radio" 
                  name="answer-{{ question.questionId }}" 
                  value="A" 
                  id="answerA-{{ question.questionId }}"
                  [checked]="getSelectedAnswer(question.questionId) === 'A'"
                  (change)="onAnswerChange(question.questionId, 'A')">
                <label class="form-check-label" for="answerA-{{ question.questionId }}">
                  A. {{ question.answerA }}
                </label>
              </div>
              
              <div class="form-check">
                <input 
                  class="form-check-input" 
                  type="radio" 
                  name="answer-{{ question.questionId }}" 
                  value="B" 
                  id="answerB-{{ question.questionId }}"
                  [checked]="getSelectedAnswer(question.questionId) === 'B'"
                  (change)="onAnswerChange(question.questionId, 'B')">
                <label class="form-check-label" for="answerB-{{ question.questionId }}">
                  B. {{ question.answerB }}
                </label>
              </div>
              
              <div class="form-check">
                <input 
                  class="form-check-input" 
                  type="radio" 
                  name="answer-{{ question.questionId }}" 
                  value="C" 
                  id="answerC-{{ question.questionId }}"
                  [checked]="getSelectedAnswer(question.questionId) === 'C'"
                  (change)="onAnswerChange(question.questionId, 'C')">
                <label class="form-check-label" for="answerC-{{ question.questionId }}">
                  C. {{ question.answerC }}
                </label>
              </div>
              
              <div class="form-check">
                <input 
                  class="form-check-input" 
                  type="radio" 
                  name="answer-{{ question.questionId }}" 
                  value="D" 
                  id="answerD-{{ question.questionId }}"
                  [checked]="getSelectedAnswer(question.questionId) === 'D'"
                  (change)="onAnswerChange(question.questionId, 'D')">
                <label class="form-check-label" for="answerD-{{ question.questionId }}">
                  D. {{ question.answerD }}
                </label>
              </div>
            </div>
          </div>

          <!-- Navigation buttons -->
          <div class="next-button mt-4 d-flex justify-content-between">
            @if (currentQuestionIndex() > 0) {
              <button 
                type="button" 
                class="btn btn-secondary" 
                (click)="previousQuestion()">
                <i class="fas fa-arrow-left"></i> Previous
              </button>
            } @else {
              <div></div>
            }
            
            @if (currentQuestionIndex() < questions().length - 1) {
              <button 
                type="button" 
                class="btn btn-success" 
                (click)="nextQuestion()">
                Next <i class="fas fa-arrow-right"></i>
              </button>
            } @else {
              <div></div>
            }
          </div>
        }
      </div>
    </div>
  </div>

  <!-- Confirmation Modal -->
  @if (showConfirmModal()) {
    <div class="modal" style="display: block;" (click)="closeConfirmModal()">
      <div class="modal-content" (click)="$event.stopPropagation()">
        <p>Submit the test?</p>
        <button 
          id="confirmSubmit" 
          class="btn btn-danger" 
          (click)="confirmSubmit()"
          [disabled]="submitting()">
          @if (submitting()) {
            <span class="spinner-border spinner-border-sm me-2" role="status"></span>
          }
          Yes
        </button>
        <button 
          id="cancelSubmit" 
          class="btn btn-secondary" 
          (click)="closeConfirmModal()"
          [disabled]="submitting()">
          No
        </button>
      </div>
    </div>
  }
} @else {
  <div class="d-flex align-items-center justify-content-center" style="height: 100vh;">
    <h5 class="text-muted">No questions available</h5>
  </div>
}
